<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Encuentra respuestas a tus preguntas sobre TuCitaSegura.">
  <title>Ayuda y Soporte - TuCitaSegura</title>
  <meta name="robots" content="noindex,nofollow">
  <meta name="theme-color" content="#0F172A">

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="./css/output.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#0F172A',
            accent: '#0ea5e9',
            blue: { 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 700: '#0369a1' }
          },
          fontFamily: { inter: ['Inter', 'system-ui', 'sans-serif'] },
        }
      }
    }
  </script>

  <style>
    body { font-family: 'Inter', system-ui, sans-serif; background: linear-gradient(135deg, #0F172A 0%, #1e3a8a 100%); }
    .glass { background: rgba(255,255,255,0.08); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.12); }
    .gradient-text { background: linear-gradient(135deg, #7dd3fc, #0ea5e9, #38bdf8); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
    .btn-primary { background: linear-gradient(135deg, #0ea5e9, #0369a1); box-shadow: 0 8px 24px rgba(14,165,233,0.2); transition:all 0.3s ease; }
    .btn-primary:hover { transform: translateY(-2px); }
    .faq-item details[open] summary ~ * { animation: sweep .5s ease-in-out; }
    @keyframes sweep {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .faq-item summary::-webkit-details-marker { display: none; }
  </style>
</head>
<body class="text-white min-h-screen">

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[100]">
    <div class="text-center">
      <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mb-4"></div>
      <p class="text-xl font-semibold">Cargando...</p>
    </div>
  </div>

  <!-- Header -->
  <header class="w-full top-0 z-50 glass">
    <nav class="max-w-7xl mx-auto px-4 flex items-center justify-between h-16" role="navigation">
      <a href="/" class="flex items-center gap-3">
        <i class="fa-solid fa-heart-circle-check text-blue-400 text-2xl"></i>
        <span class="font-black text-xl text-blue-300">TuCitaSegura</span>
      </a>
      <div class="hidden md:flex items-center gap-6">
        <a href="/webapp/buscar-usuarios.html" class="hover:text-blue-400">Buscar</a>
        <a href="/webapp/conversaciones.html" class="hover:text-blue-400">Mensajes</a>
        <a href="/webapp/perfil.html" class="btn-primary px-6 py-2 rounded-full font-semibold">Mi Perfil</a>
      </div>
    </nav>
  </header>

  <main class="pt-24 pb-12">
    <div class="max-w-4xl mx-auto px-4">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-black gradient-text">Centro de Ayuda</h1>
        <p class="text-blue-200 mt-2 text-lg">¿Tienes alguna duda? Encuentra aquí las respuestas.</p>
        <div class="mt-6 max-w-xl mx-auto relative">
          <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-blue-200"></i>
          <input type="search" id="faq-search" class="w-full bg-white/5 border border-white/20 rounded-full py-3 pl-12 pr-4 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Busca por palabra clave (ej: depósito, pin...)">
        </div>
      </div>

      <!-- FAQ List -->
      <div id="faq-list" class="space-y-4">

        <!-- FAQ: Depósito -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Cómo funciona el depósito antiplantón de 120€?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>El depósito es una garantía de compromiso. Funciona así:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li><strong>Pago único:</strong> Al proponer tu primera cita, abonas 120€ que quedan como depósito en la plataforma.</li>
                <li><strong>Reembolso automático:</strong> Tras cada cita, cuando ambos validáis la asistencia con el sistema de PIN y geolocalización, el depósito se te devuelve íntegramente de forma automática.</li>
                <li><strong>Seguridad para todos:</strong> Si un usuario no se presenta sin cancelar (hace "default"), su depósito se retiene como compensación y su reputación baja. Tu depósito, en cambio, se te devuelve.</li>
              </ul>
            </div>
          </details>
        </div>

        <!-- FAQ: Validación -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Cómo se valida una cita para que me devuelvan el depósito?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>La validación es un proceso seguro en 3 pasos:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li><strong>Ventana de tiempo y lugar:</strong> La opción para validar solo se activa desde 30 minutos antes hasta 30 minutos después de la hora de la cita, y solo si estás a menos de 250 metros del lugar acordado.</li>
                <li><strong>Intercambio de PINs:</strong> En el detalle de la cita, verás tu PIN de 4 dígitos. Debes dárselo a la otra persona, y ella a ti el suyo. Introduces el PIN que te han dado en tu móvil.</li>
                <li><strong>Periodo de seguridad:</strong> Una vez ambos introducís los PINs, se inicia un periodo de seguridad de 1 hora. Si en esa hora nadie reporta un problema, la cita se da por validada y se procesa el reembolso.</li>
              </ul>
            </div>
          </details>
        </div>

        <!-- FAQ: Reputación -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Qué es el sistema de reputación (Oro, Plata, Bronce, Platino)?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>El sistema de reputación solo aplica a los perfiles de hombres y es una medida de confianza basada en el comportamiento. Todos los hombres empiezan con reputación ORO. Cada vez que un hombre no se presenta a una cita ("default"), su reputación baja un nivel (de Oro a Plata, de Plata a Bronce). Una buena reputación te da acceso a mejores matches y demuestra que eres un usuario de confianza.</p>
              <div class="mt-3 space-y-2">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs rounded-full bg-gradient-to-r from-cyan-400 to-blue-500 font-bold">PLATINO</span>
                  <span class="text-sm">30+ citas completadas, excelente rating</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600 font-bold">ORO</span>
                  <span class="text-sm">15+ citas completadas, buen rating</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs rounded-full bg-gradient-to-r from-gray-400 to-gray-600 font-bold">PLATA</span>
                  <span class="text-sm">5+ citas completadas</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs rounded-full bg-gradient-to-r from-orange-700 to-orange-900 font-bold">BRONCE</span>
                  <span class="text-sm">Nuevos usuarios o con reportes</span>
                </div>
              </div>
            </div>
          </details>
        </div>

        <!-- FAQ: SOS (solo mujeres) -->
        <div id="faq-sos-item" class="faq-item glass rounded-lg hidden">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Para qué sirve el botón SOS? (Solo para chicas)</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>El botón SOS es una herramienta de emergencia exclusiva para nuestras usuarias. Si en algún momento te sientes en peligro, puedes activarlo. Nuestro protocolo es el siguiente:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Recibimos una alerta inmediata y nuestro equipo de seguridad te llama a tu teléfono registrado.</li>
                <li>Si no contestas, contactamos con las autoridades locales y les proporcionamos tu última ubicación conocida.</li>
              </ul>
              <p class="mt-2 font-bold text-amber-300">Es una función para emergencias reales. Su uso inadecuado puede conllevar la suspensión de la cuenta.</p>
            </div>
          </details>
        </div>

        <!-- FAQ: Membresía -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Qué incluye la membresía premium?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>La membresía premium (€30 + IVA/mes) te permite:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Enviar solicitudes de cita ilimitadas</li>
                <li>Chat sin restricciones con tus matches</li>
                <li>Búsqueda avanzada con todos los filtros</li>
                <li>Vista en mapa con geolocalización</li>
                <li>Sistema de reputación activo</li>
                <li>Soporte prioritario</li>
              </ul>
              <p class="mt-3"><strong>Nota:</strong> Actualmente solo los hombres necesitan membresía premium. Las mujeres tienen acceso gratuito.</p>
            </div>
          </details>
        </div>

        <!-- FAQ: Cancelación -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Puedo cancelar mi membresía en cualquier momento?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>Sí, puedes cancelar tu suscripción en cualquier momento desde tu <a href="/webapp/cuenta-pagos.html" class="text-blue-400 underline">gestión de pagos</a>. No hay cargos por cancelación y seguirás teniendo acceso hasta el final del período que pagaste.</p>
            </div>
          </details>
        </div>

        <!-- FAQ: Seguridad -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Cómo garantiza TuCitaSegura mi seguridad?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>Tu seguridad es nuestra prioridad. Implementamos:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Verificación de email obligatoria</li>
                <li>Sistema de reputación basado en comportamiento</li>
                <li>Validación de citas con geolocalización</li>
                <li>Botón SOS para emergencias (mujeres)</li>
                <li>Sistema de reportes y moderación 24/7</li>
                <li>Bloqueo inmediato de usuarios problemáticos</li>
              </ul>
              <p class="mt-3">Visita nuestro <a href="/webapp/seguridad.html" class="text-blue-400 underline">Centro de Seguridad</a> para más información.</p>
            </div>
          </details>
        </div>

        <!-- FAQ: Privacidad -->
        <div class="faq-item glass rounded-lg">
          <details>
            <summary class="flex justify-between items-center p-6 cursor-pointer hover:bg-white/5 transition">
              <span class="font-bold text-lg">¿Mis datos personales están protegidos?</span>
              <i class="fa-solid fa-chevron-down transition-transform duration-300"></i>
            </summary>
            <div class="p-6 pt-0 text-blue-200">
              <p>Absolutamente. Todos tus datos están protegidos con:</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Encriptación SSL/TLS en todas las comunicaciones</li>
                <li>Almacenamiento seguro en Firebase (Google Cloud)</li>
                <li>Cumplimiento GDPR y protección de datos</li>
                <li>No compartimos tu información con terceros</li>
                <li>Los pagos son procesados por PayPal (nunca almacenamos tarjetas)</li>
              </ul>
            </div>
          </details>
        </div>

      </div>

      <!-- Contacto -->
      <div class="mt-12 text-center glass rounded-2xl p-8">
        <h2 class="text-2xl font-bold gradient-text">¿No encuentras lo que buscas?</h2>
        <p class="text-blue-200 mt-2 mb-6">Nuestro equipo de soporte está aquí para ayudarte.</p>
        <a href="mailto:soporte@tucitasegura.com" class="btn-primary font-bold px-8 py-3 rounded-full inline-block">
          <i class="fa-solid fa-envelope mr-2"></i>Contactar con Soporte
        </a>
      </div>
    </div>
  </main>

  <!-- Error Fixes -->
  <script src="/webapp/js/error-fixes.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    // Import App Check FIRST (must be before firebase-config.js)
    // TEMP DISABLED: import './js/firebase-appcheck.js';

    // Then import Firebase services
    import { auth, db } from './js/firebase-config.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { loadTheme } from './js/theme.js';

    let currentUser = null;
    let currentUserData = null;

    // Auth State
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
        document.getElementById('loadingOverlay').classList.add('hidden');
      } else {
        // Allow access without login for help page
        document.getElementById('loadingOverlay').classList.add('hidden');
      }
    });

    // Load user data
    async function loadUserData() {
      try {
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        if (userDoc.exists()) {
          currentUserData = { id: userDoc.id, ...userDoc.data() };

          // Load user theme
          loadTheme(currentUserData);

          // Show SOS FAQ only for women
          const faqSosItem = document.getElementById('faq-sos-item');
          if (currentUserData.gender === 'femenino') {
            faqSosItem.classList.remove('hidden');
          }
        }
      } catch (error) {
        console.error('Error loading user data:', error);
      }
    }

    // Rotación de flecha en acordeón
    const detailsElements = document.querySelectorAll('.faq-item details');
    detailsElements.forEach(details => {
      details.addEventListener('toggle', () => {
        const icon = details.querySelector('summary i');
        if (details.open) {
          icon.classList.add('rotate-180');
        } else {
          icon.classList.remove('rotate-180');
        }
      });
    });

    // Búsqueda en FAQ
    const searchInput = document.getElementById('faq-search');
    const faqItems = document.querySelectorAll('.faq-item');
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      faqItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm) || searchTerm === '') {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });

  </script>

</body>
</html>
