<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Concierge - TuCitaSegura</title>
  <link rel="stylesheet" href="./css/output.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(138, 43, 226, 0.3), transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(255, 0, 128, 0.2), transparent 50%);
      animation: backgroundMove 15s ease infinite;
      z-index: 0;
    }

    @keyframes backgroundMove {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    /* Glassmorphism containers */
    .glass-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-5px);
    }

    .event-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .event-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .gradient-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }

    .gradient-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    /* Loading Overlay */
    .loading-overlay {
      background: rgba(102, 126, 234, 0.95);
      backdrop-filter: blur(10px);
    }

    /* Modal */
    .modal-overlay {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
    }

    /* Badge */
    .badge-concierge {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
    }

    /* Floating Animation */
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .float-animation {
      animation: float 3s ease-in-out infinite;
    }

    .glass-input {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: white;
      transition: all 0.3s ease;
    }

    .glass-input:focus {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      outline: none;
    }

    .glass-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
  </style>
</head>
<body class="relative">

  <!-- Loading Overlay -->
  <div id="loading" class="loading-overlay fixed inset-0 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white mb-4"></div>
      <p class="text-white text-xl font-semibold">Cargando Panel Concierge...</p>
    </div>
  </div>

  <!-- Main Content -->
  <div id="content" class="hidden relative z-10 min-h-screen">

    <!-- Navigation Bar -->
    <nav class="glass-container fixed top-0 left-0 right-0 z-40 mx-4 mt-4">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center space-x-3">
            <div class="bg-gradient-to-r from-amber-500 to-yellow-600 p-2 rounded-xl">
              <i class="fas fa-briefcase text-white text-xl"></i>
            </div>
            <span class="text-white font-bold text-xl">Panel Concierge</span>
            <span class="badge-concierge px-3 py-1 rounded-full text-white text-xs font-bold">
              ðŸŽ© Verificado
            </span>
          </div>

          <div class="hidden md:flex items-center space-x-6">
            <a href="/webapp/perfil.html" class="text-white hover:text-purple-200 transition">
              <i class="fas fa-user mr-2"></i>Perfil
            </a>
          </div>

          <button id="logoutBtn" class="text-white hover:bg-white hover:bg-opacity-20 px-4 py-2 rounded-lg transition">
            <i class="fas fa-sign-out-alt mr-2"></i>Salir
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="pt-24 pb-12 px-4">
      <div class="max-w-7xl mx-auto">

        <!-- Page Header -->
        <div class="text-center mb-8 float-animation">
          <div class="inline-block bg-gradient-to-r from-amber-500 to-yellow-600 p-4 rounded-2xl mb-4">
            <i class="fas fa-crown text-white text-5xl"></i>
          </div>
          <h1 class="text-white text-4xl md:text-5xl font-bold mb-3">ðŸŽ© Panel Concierge</h1>
          <p class="text-white text-opacity-90 text-lg">Gestiona tus eventos VIP y selecciona candidatas</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="stat-card p-6">
            <div class="flex items-center justify-between mb-2">
              <i class="fas fa-calendar-check text-green-300 text-3xl"></i>
            </div>
            <p class="text-white text-opacity-70 text-sm">Eventos Activos</p>
            <p id="activeEventsCount" class="text-white text-3xl font-bold">0</p>
          </div>

          <div class="stat-card p-6">
            <div class="flex items-center justify-between mb-2">
              <i class="fas fa-users text-blue-300 text-3xl"></i>
            </div>
            <p class="text-white text-opacity-70 text-sm">Total Aplicantes</p>
            <p id="totalApplicantsCount" class="text-white text-3xl font-bold">0</p>
          </div>

          <div class="stat-card p-6">
            <div class="flex items-center justify-between mb-2">
              <i class="fas fa-check-circle text-purple-300 text-3xl"></i>
            </div>
            <p class="text-white text-opacity-70 text-sm">Seleccionadas</p>
            <p id="selectedApplicantsCount" class="text-white text-3xl font-bold">0</p>
          </div>

          <div class="stat-card p-6">
            <div class="flex items-center justify-between mb-2">
              <i class="fas fa-history text-yellow-300 text-3xl"></i>
            </div>
            <p class="text-white text-opacity-70 text-sm">Eventos Pasados</p>
            <p id="pastEventsCount" class="text-white text-3xl font-bold">0</p>
          </div>
        </div>

        <!-- Create Event Button -->
        <div class="mb-6">
          <button id="createEventBtn" class="gradient-button px-8 py-4 rounded-lg text-white font-semibold text-lg shadow-lg">
            <i class="fas fa-plus-circle mr-2"></i>Crear Nuevo Evento VIP
          </button>
        </div>

        <!-- Active Events -->
        <div class="glass-container p-6 mb-8">
          <h2 class="text-white text-2xl font-bold mb-6">
            <i class="fas fa-calendar-alt mr-2"></i>Mis Eventos Activos
          </h2>
          <div id="activeEventsList" class="space-y-4">
            <!-- Events will be loaded here -->
          </div>
          <div id="noActiveEvents" class="hidden text-center py-12">
            <i class="fas fa-calendar-times text-white text-opacity-50 text-6xl mb-4"></i>
            <p class="text-white text-opacity-70 text-lg">No tienes eventos activos</p>
            <p class="text-white text-opacity-50 text-sm">Crea tu primer evento VIP para empezar</p>
          </div>
        </div>

        <!-- Past Events -->
        <div class="glass-container p-6">
          <h2 class="text-white text-2xl font-bold mb-6">
            <i class="fas fa-history mr-2"></i>Eventos Pasados
          </h2>
          <div id="pastEventsList" class="space-y-4">
            <!-- Events will be loaded here -->
          </div>
          <div id="noPastEvents" class="hidden text-center py-12">
            <i class="fas fa-inbox text-white text-opacity-50 text-5xl mb-4"></i>
            <p class="text-white text-opacity-70">No hay eventos pasados</p>
          </div>
        </div>

      </div>
    </main>

  </div>

  <!-- Create Event Modal -->
  <div id="createEventModal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-container max-w-3xl w-full max-h-[90vh] overflow-y-auto p-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-white text-2xl font-bold">
          <i class="fas fa-plus-circle mr-2"></i>Crear Evento VIP
        </h2>
        <button id="closeModalBtn" class="text-white hover:text-red-400 text-2xl">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form id="createEventForm" class="space-y-4">
        <!-- Title -->
        <div>
          <label class="text-white text-sm mb-2 block">TÃ­tulo del Evento *</label>
          <input type="text" id="eventTitle" required maxlength="100"
                 class="w-full glass-input px-4 py-3"
                 placeholder="Ej: Cena VIP en Madrid">
        </div>

        <!-- Description -->
        <div>
          <label class="text-white text-sm mb-2 block">DescripciÃ³n *</label>
          <textarea id="eventDescription" required rows="4"
                    class="w-full glass-input px-4 py-3"
                    placeholder="Describe el evento, quÃ© se espera, ambiente, etc."></textarea>
        </div>

        <!-- Event Type -->
        <div>
          <label class="text-white text-sm mb-2 block">Tipo de Evento *</label>
          <select id="eventType" required class="w-full glass-input px-4 py-3">
            <option value="">Selecciona un tipo</option>
            <option value="dinner">Cena</option>
            <option value="party">Fiesta</option>
            <option value="travel">Viaje</option>
            <option value="networking">Networking</option>
            <option value="other">Otro</option>
          </select>
        </div>

        <!-- Date and Time -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-white text-sm mb-2 block">Fecha del Evento *</label>
            <input type="date" id="eventDate" required
                   class="w-full glass-input px-4 py-3">
          </div>
          <div>
            <label class="text-white text-sm mb-2 block">Hora *</label>
            <input type="time" id="eventTime" required
                   class="w-full glass-input px-4 py-3">
          </div>
        </div>

        <!-- Location -->
        <div>
          <label class="text-white text-sm mb-2 block">Ciudad *</label>
          <select id="eventCity" required class="w-full glass-input px-4 py-3">
            <option value="">Selecciona una ciudad</option>
            <option value="Madrid">Madrid</option>
            <option value="Barcelona">Barcelona</option>
            <option value="Valencia">Valencia</option>
            <option value="Sevilla">Sevilla</option>
            <option value="MÃ¡laga">MÃ¡laga</option>
            <option value="Bilbao">Bilbao</option>
            <option value="Otra">Otra</option>
          </select>
        </div>

        <div>
          <label class="text-white text-sm mb-2 block">DirecciÃ³n/Lugar *</label>
          <input type="text" id="eventAddress" required
                 class="w-full glass-input px-4 py-3"
                 placeholder="Ej: Restaurante BotÃ­n, Calle Cuchilleros 17">
        </div>

        <!-- Compensation -->
        <div>
          <label class="text-white text-sm mb-2 block">CompensaciÃ³n por Persona (â‚¬) *</label>
          <input type="number" id="eventCompensation" required min="50" step="10"
                 class="w-full glass-input px-4 py-3"
                 placeholder="Ej: 300">
        </div>

        <!-- Spots Available -->
        <div>
          <label class="text-white text-sm mb-2 block">NÃºmero de Plazas Disponibles *</label>
          <input type="number" id="eventSpots" required min="1" max="50"
                 class="w-full glass-input px-4 py-3"
                 placeholder="Ej: 5">
        </div>

        <!-- Requirements -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-white text-sm mb-2 block">Edad MÃ­nima *</label>
            <input type="number" id="minAge" required min="18" max="100"
                   class="w-full glass-input px-4 py-3"
                   placeholder="Ej: 25">
          </div>
          <div>
            <label class="text-white text-sm mb-2 block">Edad MÃ¡xima *</label>
            <input type="number" id="maxAge" required min="18" max="100"
                   class="w-full glass-input px-4 py-3"
                   placeholder="Ej: 35">
          </div>
        </div>

        <div>
          <label class="text-white text-sm mb-2 block">CÃ³digo de Vestimenta</label>
          <input type="text" id="dresscode"
                 class="w-full glass-input px-4 py-3"
                 placeholder="Ej: Elegante, Casual, Formal">
        </div>

        <div>
          <label class="text-white text-sm mb-2 block">Otros Requisitos</label>
          <textarea id="otherRequirements" rows="2"
                    class="w-full glass-input px-4 py-3"
                    placeholder="Idiomas, habilidades especiales, etc."></textarea>
        </div>

        <!-- Submit Buttons -->
        <div class="flex space-x-4 pt-4">
          <button type="submit" class="flex-1 gradient-button px-6 py-3 rounded-lg text-white font-semibold">
            <i class="fas fa-check mr-2"></i>Publicar Evento
          </button>
          <button type="button" id="cancelCreateBtn" class="px-6 py-3 rounded-lg text-white font-semibold bg-red-500 hover:bg-red-600 transition">
            <i class="fas fa-times mr-2"></i>Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="hidden fixed bottom-8 right-8 glass-container px-6 py-4 rounded-lg shadow-lg z-50 max-w-md">
    <div class="flex items-center space-x-3">
      <i id="toastIcon" class="fas fa-check-circle text-2xl"></i>
      <p id="toastMessage" class="text-white font-semibold"></p>
    </div>
  </div>

  <!-- Error Fixes -->
  <script src="/webapp/js/error-fixes.js"></script>

  <!-- Firebase Scripts -->
  <script type="module">
    // Import App Check FIRST (must be before firebase-config.js)
    import './js/firebase-appcheck.js';

    // Then import Firebase services
    import { auth, db } from './js/firebase-config.js';
    import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import {
      collection,
      query,
      where,
      orderBy,
      getDocs,
      addDoc,
      doc,
      getDoc,
      Timestamp,
      serverTimestamp
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import { loadTheme } from './js/theme.js';

    let currentUser = null;
    let currentUserData = null;
    let myEvents = [];

    // Check authentication
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = '/webapp/login.html';
        return;
      }

      currentUser = user;

      // Load user data
      const userDoc = await getDoc(doc(db, 'users', user.uid));
      if (userDoc.exists()) {
        currentUserData = { id: userDoc.id, ...userDoc.data() };

        // Load theme
        loadTheme(currentUserData);

        // Verificar que sea concierge
        if (currentUserData.userRole !== 'concierge' ||
            currentUserData.conciergeStatus !== 'approved') {
          showToast('Acceso denegado. Solo para Concierges aprobados.', 'error');
          setTimeout(() => {
            window.location.href = '/webapp/perfil.html';
          }, 2000);
          return;
        }

        // Load events
        await loadMyEvents();

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
      }
    });

    // Load concierge's events
    async function loadMyEvents() {
      try {
        const eventsQuery = query(
          collection(db, 'vip_events'),
          where('conciergeId', '==', currentUser.uid),
          orderBy('createdAt', 'desc')
        );

        const eventsSnapshot = await getDocs(eventsQuery);
        myEvents = [];
        let activeEvents = [];
        let pastEvents = [];
        let totalApplicants = 0;
        let totalSelected = 0;

        for (const eventDoc of eventsSnapshot.docs) {
          const eventData = { id: eventDoc.id, ...eventDoc.data() };

          // Get applications count
          const applicationsQuery = query(
            collection(db, 'vip_applications'),
            where('eventId', '==', eventDoc.id)
          );
          const applicationsSnapshot = await getDocs(applicationsQuery);

          eventData.applicationsCount = applicationsSnapshot.size;
          eventData.selectedCount = applicationsSnapshot.docs.filter(
            doc => doc.data().status === 'selected'
          ).length;

          totalApplicants += eventData.applicationsCount;
          totalSelected += eventData.selectedCount;

          // Check if event is past
          const eventDate = eventData.eventDate?.toDate();
          const isPast = eventDate && eventDate < new Date();

          if (isPast || eventData.status === 'completed' || eventData.status === 'canceled') {
            pastEvents.push(eventData);
          } else {
            activeEvents.push(eventData);
          }

          myEvents.push(eventData);
        }

        // Update stats
        document.getElementById('activeEventsCount').textContent = activeEvents.length;
        document.getElementById('totalApplicantsCount').textContent = totalApplicants;
        document.getElementById('selectedApplicantsCount').textContent = totalSelected;
        document.getElementById('pastEventsCount').textContent = pastEvents.length;

        // Render events
        renderActiveEvents(activeEvents);
        renderPastEvents(pastEvents);

      } catch (error) {
        console.error('Error loading events:', error);
        showToast('Error al cargar eventos', 'error');
      }
    }

    // Render active events
    function renderActiveEvents(events) {
      const activeEventsList = document.getElementById('activeEventsList');
      const noActiveEvents = document.getElementById('noActiveEvents');

      if (events.length === 0) {
        activeEventsList.innerHTML = '';
        noActiveEvents.classList.remove('hidden');
        return;
      }

      noActiveEvents.classList.add('hidden');
      activeEventsList.innerHTML = '';

      events.forEach((event) => {
        const eventCard = createEventCard(event);
        activeEventsList.appendChild(eventCard);
      });
    }

    // Render past events
    function renderPastEvents(events) {
      const pastEventsList = document.getElementById('pastEventsList');
      const noPastEvents = document.getElementById('noPastEvents');

      if (events.length === 0) {
        pastEventsList.innerHTML = '';
        noPastEvents.classList.remove('hidden');
        return;
      }

      noPastEvents.classList.add('hidden');
      pastEventsList.innerHTML = '';

      events.forEach((event) => {
        const eventCard = createEventCard(event, true);
        pastEventsList.appendChild(eventCard);
      });
    }

    // Create event card
    function createEventCard(event, isPast = false) {
      const eventDate = event.eventDate?.toDate();
      const formattedDate = eventDate ? eventDate.toLocaleDateString('es-ES', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }) : 'Fecha no disponible';

      const spotsLeft = event.spotsAvailable - (event.spotsSelected || 0);

      const card = document.createElement('div');
      card.className = `event-card p-6 ${isPast ? 'opacity-75' : ''}`;
      card.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <div class="flex-1">
            <h3 class="text-white font-bold text-xl mb-2">${event.title || 'Sin tÃ­tulo'}</h3>
            <p class="text-white text-opacity-70 text-sm mb-2">${event.description?.substring(0, 100)}...</p>
          </div>
          <div class="text-right">
            <span class="bg-gradient-to-r from-purple-600 to-pink-600 px-3 py-1 rounded-full text-white text-xs font-bold">
              ${event.status === 'published' ? 'âœ“ Publicado' : event.status === 'completed' ? 'âœ“ Completado' : event.status}
            </span>
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          <div class="stat-card p-3 text-center">
            <p class="text-white text-opacity-70 text-xs mb-1">Aplicantes</p>
            <p class="text-white text-2xl font-bold">${event.applicationsCount || 0}</p>
          </div>
          <div class="stat-card p-3 text-center">
            <p class="text-white text-opacity-70 text-xs mb-1">Seleccionadas</p>
            <p class="text-white text-2xl font-bold">${event.selectedCount || 0}/${event.spotsAvailable}</p>
          </div>
          <div class="stat-card p-3 text-center">
            <p class="text-white text-opacity-70 text-xs mb-1">Plazas Libres</p>
            <p class="text-white text-2xl font-bold">${spotsLeft}</p>
          </div>
          <div class="stat-card p-3 text-center">
            <p class="text-white text-opacity-70 text-xs mb-1">CompensaciÃ³n</p>
            <p class="text-white text-2xl font-bold">â‚¬${event.compensation?.amount || 0}</p>
          </div>
        </div>

        <div class="flex items-center text-white text-opacity-80 text-sm mb-4">
          <i class="fas fa-calendar mr-2"></i>
          <span>${formattedDate}</span>
          <i class="fas fa-map-marker-alt ml-4 mr-2"></i>
          <span>${event.location?.city || 'N/A'}</span>
        </div>

        <div class="flex space-x-3">
          <button
            onclick="window.location.href='/webapp/evento-detalle.html?eventId=${event.id}'"
            class="flex-1 gradient-button px-4 py-2 rounded-lg text-white font-semibold">
            <i class="fas fa-users mr-2"></i>Ver Aplicantes (${event.applicationsCount || 0})
          </button>
        </div>
      `;

      return card;
    }

    // Create Event Modal
    document.getElementById('createEventBtn').addEventListener('click', () => {
      document.getElementById('createEventModal').classList.remove('hidden');
    });

    document.getElementById('closeModalBtn').addEventListener('click', () => {
      document.getElementById('createEventModal').classList.add('hidden');
    });

    document.getElementById('cancelCreateBtn').addEventListener('click', () => {
      document.getElementById('createEventModal').classList.add('hidden');
    });

    // Create Event Form Submit
    document.getElementById('createEventForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      try {
        const eventDate = new Date(document.getElementById('eventDate').value + 'T' + document.getElementById('eventTime').value);

        const newEvent = {
          conciergeId: currentUser.uid,
          conciergeName: currentUserData.alias || currentUserData.email,

          title: document.getElementById('eventTitle').value,
          description: document.getElementById('eventDescription').value,
          eventType: document.getElementById('eventType').value,

          eventDate: Timestamp.fromDate(eventDate),
          eventTime: document.getElementById('eventTime').value,

          location: {
            address: document.getElementById('eventAddress').value,
            city: document.getElementById('eventCity').value,
            country: 'EspaÃ±a'
          },

          compensation: {
            amount: parseFloat(document.getElementById('eventCompensation').value),
            currency: 'EUR',
            type: 'per_person'
          },

          spotsAvailable: parseInt(document.getElementById('eventSpots').value),
          spotsSelected: 0,

          requirements: {
            minAge: parseInt(document.getElementById('minAge').value),
            maxAge: parseInt(document.getElementById('maxAge').value),
            dresscode: document.getElementById('dresscode').value,
            other: document.getElementById('otherRequirements').value
          },

          status: 'published',
          isActive: true,
          totalApplications: 0,
          selectedApplicants: [],

          createdAt: serverTimestamp(),
          publishedAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };

        await addDoc(collection(db, 'vip_events'), newEvent);

        showToast('Evento VIP creado exitosamente', 'success');

        // Close modal and reset form
        document.getElementById('createEventModal').classList.add('hidden');
        document.getElementById('createEventForm').reset();

        // Reload events
        await loadMyEvents();

      } catch (error) {
        console.error('Error creating event:', error);
        showToast('Error al crear evento: ' + error.message, 'error');
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      try {
        await signOut(auth);
        window.location.href = '/webapp/login.html';
      } catch (error) {
        console.error('Error signing out:', error);
        showToast('Error al cerrar sesiÃ³n', 'error');
      }
    });

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = document.getElementById('toastIcon');

      toastMessage.textContent = message;

      if (type === 'success') {
        toastIcon.className = 'fas fa-check-circle text-green-400 text-2xl';
      } else if (type === 'error') {
        toastIcon.className = 'fas fa-exclamation-circle text-red-400 text-2xl';
      }

      toast.classList.remove('hidden');

      setTimeout(() => {
        toast.classList.add('hidden');
      }, 4000);
    }

    // Expose showToast globally
    window.showToast = showToast;
  </script>

</body>
</html>
