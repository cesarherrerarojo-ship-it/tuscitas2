# üí∞ Reglas de Negocio - TuCitaSegura

## üéØ Modelo de Monetizaci√≥n

TuCitaSegura implementa un **modelo de negocio basado en membres√≠as y seguro anti-plant√≥n** para garantizar seriedad y compromiso en todas las citas.

---

## üë• Reglas por Rol y G√©nero

### üé© Usuarios Concierge (NUEVO - Premium)

**NUEVO ROL:** Usuarios verificados que pueden publicar eventos VIP para seleccionar candidatas.

#### Suscripci√≥n Concierge (‚Ç¨199/mes)
**Requerido para:**
- ‚úÖ Publicar eventos VIP
- ‚úÖ Acceder a panel de gesti√≥n de eventos
- ‚úÖ Ver aplicantes y seleccionar candidatas
- ‚úÖ Badge "Concierge Verificado üé©"
- ‚úÖ Soporte prioritario

**Requisitos adicionales:**
- üîê Verificaci√≥n de identidad (KYC)
- üë• Aprobaci√≥n manual del equipo
- üí≥ Pago mensual de ‚Ç¨199
- üìã Aceptar t√©rminos espec√≠ficos de Concierge

**Sin suscripci√≥n Concierge NO puedes:**
- ‚ùå Publicar eventos VIP
- ‚ùå Acceder a base de candidatas
- ‚ùå Gestionar selecci√≥n de aplicantes

**Acceso especial:**
- üìä Dashboard exclusivo en `/webapp/concierge-dashboard.html`
- üìù Publicaci√≥n ilimitada de eventos VIP
- üëÅÔ∏è Visualizaci√≥n de perfiles de aplicantes
- üìß Notificaciones cuando alguien aplica

---

### üöπ Usuarios Masculinos (Actuales)

**REGLA CR√çTICA:** Los hombres **DEBEN** tener ambos pagos activos para usar la plataforma completamente.

#### 1. Membres√≠a Mensual (‚Ç¨29.99/mes)
**Requerida para:**
- ‚úÖ Enviar solicitudes de cita
- ‚úÖ Abrir conversaciones
- ‚úÖ Responder mensajes
- ‚úÖ Ver perfiles completos
- ‚úÖ Usar filtros avanzados

**Sin membres√≠a NO puedes:**
- ‚ùå Enviar solicitudes
- ‚ùå Chatear con matches
- ‚ùå Agendar citas

#### 2. Seguro Anti-Plant√≥n (‚Ç¨120 pago √∫nico)
**Requerido para:**
- ‚úÖ Agendar citas confirmadas
- ‚úÖ Acceder a informaci√≥n de contacto
- ‚úÖ Confirmar hora y lugar de encuentro

**Sin seguro NO puedes:**
- ‚ùå Completar agendamiento de citas
- ‚ùå Obtener datos de contacto
- ‚ùå Confirmar encuentros

### üö∫ Usuarios Femeninos (Actual - Gratis)

**ESTADO:** Por ahora las mujeres pueden usar TuCitaSegura **completamente gratis**.

**Pueden:**
- ‚úÖ Enviar solicitudes libremente
- ‚úÖ Chatear sin l√≠mites
- ‚úÖ Agendar citas sin pagar
- ‚úÖ Acceder a todas las funcionalidades

**Futuro:** Este modelo cambiar√° para requerir pagos de ambos g√©neros.

---

## üí≥ Productos y Precios

### 1. Suscripci√≥n Concierge (NUEVO)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PLAN CONCIERGE                       ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ ‚Ç¨199/mes                             ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ ‚úÖ Publicaci√≥n ilimitada de eventos  ‚îÇ
‚îÇ ‚úÖ Acceso a base de candidatas       ‚îÇ
‚îÇ ‚úÖ Sistema de selecci√≥n avanzado     ‚îÇ
‚îÇ ‚úÖ Badge Concierge Verificado üé©     ‚îÇ
‚îÇ ‚úÖ Notificaciones prioritarias       ‚îÇ
‚îÇ ‚úÖ Soporte dedicado 24/7             ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ [Solicitar Concierge]                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Renovaci√≥n:** Autom√°tica cada mes
**Cancelaci√≥n:** En cualquier momento
**Aprobaci√≥n:** Requiere verificaci√≥n KYC y aprobaci√≥n manual
**Uso:** Publicaci√≥n de eventos VIP para selecci√≥n de candidatas

---

### 2. Membres√≠a Premium

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PLAN MENSUAL                         ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ ‚Ç¨29.99/mes                           ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ ‚úÖ Solicitudes ilimitadas            ‚îÇ
‚îÇ ‚úÖ Chat con todos tus matches        ‚îÇ
‚îÇ ‚úÖ Filtros avanzados                 ‚îÇ
‚îÇ ‚úÖ Geolocalizaci√≥n y mapas           ‚îÇ
‚îÇ ‚úÖ Ver qui√©n te visit√≥               ‚îÇ
‚îÇ ‚úÖ Soporte prioritario               ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ [Contratar Membres√≠a]                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Renovaci√≥n:** Autom√°tica cada mes
**Cancelaci√≥n:** En cualquier momento
**Reembolso:** No aplica (servicio mensual)

### 2. Seguro Anti-Plant√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SEGURO ANTI-PLANT√ìN                  ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ ‚Ç¨120 (pago √∫nico)                    ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ üõ°Ô∏è Protecci√≥n contra plantones      ‚îÇ
‚îÇ üõ°Ô∏è Reembolso si no se presenta      ‚îÇ
‚îÇ üõ°Ô∏è Verificaci√≥n de identidad        ‚îÇ
‚îÇ üõ°Ô∏è Sistema de reputaci√≥n            ‚îÇ
‚îÇ üõ°Ô∏è Garant√≠a de seriedad             ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ [Contratar Seguro]                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Duraci√≥n:** V√°lido de por vida
**Cobertura:** Todas las citas futuras
**Reembolso:** Autom√°tico en caso de plant√≥n verificado

---

## üîí Sistema de Validaci√≥n

### Flujo de Validaci√≥n en la Plataforma

```javascript
// 1. Usuario intenta enviar solicitud de cita
function checkPaymentStatus() {
  // ¬øEs usuario que debe pagar?
  if (user.gender === 'masculino') {

    // ‚úÖ Paso 1: Verificar membres√≠a
    if (!user.hasActiveSubscription) {
      return {
        canUse: false,
        reason: 'membership',
        message: 'Necesitas membres√≠a activa'
      };
    }

    // ‚úÖ Paso 2: Verificar seguro anti-plant√≥n
    if (!user.hasAntiGhostingInsurance) {
      return {
        canUse: false,
        reason: 'insurance',
        message: 'Necesitas seguro anti-plant√≥n (‚Ç¨120)'
      };
    }

    // ‚úÖ Todo OK - puede usar la plataforma
    return { canUse: true };
  }

  // Mujeres pueden usar gratis (por ahora)
  return { canUse: true };
}
```

### Puntos de Validaci√≥n

#### üî¥ Bloqueo Total (Sin Membres√≠a)
```
Usuario sin membres√≠a ‚Üí
  1. Click en "Enviar Solicitud" ‚Üí
  2. Modal: "Membres√≠a Requerida" ‚Üí
  3. Detalles de plan ‚Ç¨29.99/mes ‚Üí
  4. Bot√≥n "Contratar Membres√≠a" ‚Üí
  5. Redirect a /webapp/suscripcion.html
```

#### üü° Bloqueo Parcial (Sin Seguro)
```
Usuario con membres√≠a pero sin seguro ‚Üí
  1. Puede ver perfiles ‚Üí
  2. Puede chatear ‚Üí
  3. NO puede agendar citas ‚Üí
  4. Al intentar agendar ‚Üí
  5. Modal: "Seguro Anti-Plant√≥n Requerido" ‚Üí
  6. Detalles de seguro ‚Ç¨120 ‚Üí
  7. Bot√≥n "Contratar Seguro" ‚Üí
  8. Redirect a /webapp/seguro.html
```

#### üü¢ Acceso Completo
```
Usuario con membres√≠a + seguro ‚Üí
  ‚úÖ Todas las funcionalidades desbloqueadas
  ‚úÖ Banner verde "Cuenta Premium Activa"
  ‚úÖ Badges: Premium üëë + Asegurado üõ°Ô∏è
```

---

## üìä Estructura de Datos Firestore

### Collection: `users`

```javascript
{
  // Datos b√°sicos
  uid: string,
  email: string,
  alias: string,
  gender: "masculino" | "femenino" | "otro",
  birthDate: string, // YYYY-MM-DD

  // ‚úÖ ROL DE USUARIO (NUEVO)
  userRole: "regular" | "admin" | "concierge",  // Rol del usuario
  isAdmin: boolean,                             // Acceso admin (legacy)
  isConcierge: boolean,                         // Shortcut para concierge

  // ‚úÖ CAMPOS CONCIERGE (NUEVO)
  conciergeStatus: "pending" | "approved" | "suspended",  // Estado aprobaci√≥n
  conciergeApprovedAt: Timestamp,               // Cu√°ndo fue aprobado
  conciergeSubscriptionId: string,              // Stripe subscription Concierge
  conciergeSubscriptionStatus: "active" | "canceled" | "expired",
  conciergeSubscriptionStartDate: Timestamp,
  conciergeSubscriptionEndDate: Timestamp,
  totalEventsPublished: number,                 // Total eventos VIP publicados
  totalApplicantsReceived: number,              // Total aplicantes recibidos

  // ‚úÖ CAMPOS DE PAGO (REGULARES)
  hasActiveSubscription: boolean,       // ¬øTiene membres√≠a activa?
  subscriptionId: string,               // ID de Stripe/PayPal
  subscriptionStartDate: Timestamp,     // Inicio de membres√≠a
  subscriptionEndDate: Timestamp,       // Fin de membres√≠a
  subscriptionStatus: "active" | "canceled" | "expired",

  hasAntiGhostingInsurance: boolean,    // ¬øTiene seguro anti-plant√≥n?
  insurancePaymentId: string,           // ID de transacci√≥n del seguro
  insurancePurchaseDate: Timestamp,     // Cu√°ndo compr√≥ el seguro
  insuranceAmount: number,              // 120 (en euros)

  // Otros campos
  location: { lat: number, lng: number },
  city: string,
  bio: string,
  reputation: "BRONCE" | "PLATA" | "ORO" | "PLATINO",
  emailVerified: boolean,
  isOnline: boolean,
  createdAt: Timestamp,
  lastActivity: Timestamp
}
```

### Collection: `subscriptions`

```javascript
{
  userId: string,
  subscriptionId: string,      // Stripe subscription ID
  plan: "monthly",             // Plan contratado
  amount: 29.99,              // Precio en euros
  currency: "EUR",
  status: "active" | "canceled" | "expired" | "past_due",
  currentPeriodStart: Timestamp,
  currentPeriodEnd: Timestamp,
  cancelAtPeriodEnd: boolean,
  paymentMethod: string,      // Stripe payment method ID
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Collection: `insurance_payments`

```javascript
{
  userId: string,
  paymentId: string,          // Stripe payment intent ID
  amount: 120,
  currency: "EUR",
  status: "succeeded" | "pending" | "failed",
  paymentMethod: "card" | "paypal" | "bank_transfer",
  purchaseDate: Timestamp,
  isActive: boolean,
  refunds: [
    {
      amount: number,
      reason: "ghosting_verified",
      date: Timestamp,
      appointmentId: string
    }
  ],
  createdAt: Timestamp
}
```

---

## üé® UI/UX de Pagos

### Banner de Estado de Pago

#### ‚úÖ Estado: Todo Pagado (Hombre con Membres√≠a + Seguro)

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úÖ Cuenta Premium Activa                     üëë Premium      ‚îÇ
‚îÇ    Membres√≠a y seguro anti-plant√≥n activos  üõ°Ô∏è Asegurado   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
**Color:** Verde (#22c55e)

#### ‚ö†Ô∏è Estado: Pagos Pendientes (Hombre sin Membres√≠a/Seguro)

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è Pagos Pendientes                                         ‚îÇ
‚îÇ    Falta: Membres√≠a mensual y Seguro anti-plant√≥n (‚Ç¨120)   ‚îÇ
‚îÇ                                     [Completar Pagos] ‚Üí     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
**Color:** Amarillo (#eab308)

#### üö´ Estado: Sin Acceso (Mujer - Oculto)

```
No se muestra banner (acceso gratis)
```

### Modal de Pago Requerido

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              üîí                         ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ    Membres√≠a Requerida                 ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  Para enviar solicitudes de cita       ‚îÇ
‚îÇ  necesitas una membres√≠a activa.       ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Plan Mensual        ‚Ç¨29.99/mes   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Solicitudes ilimitadas        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Chat con matches              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Filtros avanzados             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Soporte prioritario           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  [üí≥ Contratar Membres√≠a]     [‚úï]     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ Flujos de Usuario

### Flujo 1: Hombre Nuevo (Sin Pagos)

```
1. Registra cuenta
2. Verifica email
3. Completa perfil
4. Navega a "Buscar Usuarios"
5. ‚ö†Ô∏è Banner amarillo: "Pagos Pendientes"
6. Ve perfiles de mujeres
7. Click en "Enviar Solicitud" ‚ù§Ô∏è
8. üîí Modal: "Membres√≠a Requerida"
9. Click "Contratar Membres√≠a"
10. ‚Üí Redirect a /webapp/suscripcion.html
11. Completa pago ‚Ç¨29.99/mes
12. ‚úÖ hasActiveSubscription = true
13. Vuelve a "Buscar Usuarios"
14. Intenta agendar cita
15. üîí Modal: "Seguro Anti-Plant√≥n Requerido"
16. Click "Contratar Seguro"
17. ‚Üí Redirect a /webapp/seguro.html
18. Completa pago ‚Ç¨120
19. ‚úÖ hasAntiGhostingInsurance = true
20. Vuelve a "Buscar Usuarios"
21. ‚úÖ Banner verde: "Cuenta Premium Activa"
22. üéâ Puede usar todas las funcionalidades
```

### Flujo 2: Hombre con Membres√≠a (Falta Seguro)

```
1. Ya tiene membres√≠a activa
2. Puede enviar solicitudes ‚úÖ
3. Puede chatear ‚úÖ
4. Match aceptado
5. Intenta agendar cita
6. üîí Validaci√≥n: falta seguro
7. Modal: "Seguro Anti-Plant√≥n Requerido"
8. Contrata seguro ‚Ç¨120
9. Ahora puede agendar citas ‚úÖ
```

### Flujo 3: Mujer (Acceso Gratis)

```
1. Registra cuenta
2. Verifica email
3. Completa perfil
4. Navega a "Buscar Usuarios"
5. ‚úÖ Sin banner de pagos
6. Puede hacer todo gratis:
   - Enviar solicitudes ‚úÖ
   - Chatear ‚úÖ
   - Agendar citas ‚úÖ
7. Sin restricciones
```

---

## üìà M√©tricas de Negocio

### KPIs a Monitorear

```javascript
// 1. Conversi√≥n a Membres√≠a
const conversionRate =
  (usuariosPagaron / usuariosRegistrados) * 100;
// Target: >40%

// 2. Conversi√≥n a Seguro
const insuranceRate =
  (usuariosConSeguro / usuariosConMembresia) * 100;
// Target: >80%

// 3. Lifetime Value (LTV)
const LTV =
  (membresiaPromedio * mesesRetencion) + seguro;
// Example: (29.99 * 6) + 120 = ‚Ç¨299.94

// 4. Churn Rate
const churn =
  (cancelaciones / usuariosActivos) * 100;
// Target: <10% mensual

// 5. Revenue Per User (RPU)
const RPU =
  totalRevenue / totalUsuarios;
```

### Analytics de Eventos

```javascript
// Tracking de eventos de pago

// Vista de modal de pago
analytics.logEvent('payment_modal_shown', {
  reason: 'membership' | 'insurance',
  user_gender: 'masculino',
  user_age: number
});

// Click en "Contratar"
analytics.logEvent('payment_cta_clicked', {
  product: 'membership' | 'insurance',
  amount: number
});

// Pago completado
analytics.logEvent('payment_completed', {
  product: 'membership' | 'insurance',
  amount: number,
  payment_method: string
});

// Pago cancelado
analytics.logEvent('payment_canceled', {
  step: 'modal' | 'checkout' | 'payment'
});

// Funcionalidad bloqueada
analytics.logEvent('feature_blocked', {
  feature: 'send_request' | 'chat' | 'schedule_date',
  missing: 'membership' | 'insurance'
});
```

---

## üöÄ Migraci√≥n para G√©nero Dual

### Preparaci√≥n para Cobrar a Ambos G√©neros

Cuando se decida cobrar tambi√©n a las mujeres:

#### 1. Actualizar L√≥gica de Validaci√≥n

```javascript
// ANTES (solo hombres)
const userMustPay = currentUserData.gender === 'masculino';

// DESPU√âS (ambos g√©neros)
const userMustPay = true; // Todos pagan
```

#### 2. Comunicaci√≥n con Usuarias

```
1. Email 30 d√≠as antes: "Cambios en el modelo de precios"
2. Email 15 d√≠as antes: "Recordatorio: nuevos precios"
3. Email 7 d√≠as antes: "√öltima semana de acceso gratis"
4. Banner en app: "Tu acceso gratis termina en X d√≠as"
5. D√≠a del cambio: Modal informativo al login
```

#### 3. Plan de Precios para Mujeres

**Opci√≥n A: Mismo precio**
```
‚Ä¢ Membres√≠a: ‚Ç¨29.99/mes
‚Ä¢ Seguro: ‚Ç¨120
```

**Opci√≥n B: Precio diferenciado**
```
‚Ä¢ Membres√≠a: ‚Ç¨19.99/mes (33% descuento)
‚Ä¢ Seguro: ‚Ç¨80 (33% descuento)
```

**Opci√≥n C: Freemium**
```
‚Ä¢ B√°sico: Gratis (3 solicitudes/mes)
‚Ä¢ Premium: ‚Ç¨29.99/mes (ilimitado)
‚Ä¢ Seguro: ‚Ç¨120 (obligatorio para agendar)
```

#### 4. Grandfathering

```
Usuarias existentes antes del cambio:
‚Ä¢ 3 meses gratis de membres√≠a
‚Ä¢ 50% descuento en seguro (‚Ç¨60 en vez de ‚Ç¨120)
‚Ä¢ V√°lido por tiempo limitado
```

---

## üí° Recomendaciones de Implementaci√≥n

### Seguridad

```javascript
// ‚ùå MAL: Validar solo en frontend
if (user.hasActiveSubscription) {
  sendMatch();
}

// ‚úÖ BIEN: Validar tambi√©n en backend
// Cloud Function
exports.sendMatchRequest = functions.https.onCall(async (data, context) => {
  const userId = context.auth.uid;
  const userData = await admin.firestore()
    .collection('users').doc(userId).get();

  // Verificar g√©nero y pagos
  if (userData.gender === 'masculino') {
    if (!userData.hasActiveSubscription) {
      throw new functions.https.HttpsError(
        'failed-precondition',
        'Membership required'
      );
    }

    if (!userData.hasAntiGhostingInsurance) {
      throw new functions.https.HttpsError(
        'failed-precondition',
        'Insurance required'
      );
    }
  }

  // Proceder con la solicitud
  return createMatchRequest(data);
});
```

### Webhooks de Stripe

```javascript
// Actualizar estado de membres√≠a autom√°ticamente
exports.stripeWebhook = functions.https.onRequest(async (req, res) => {
  const event = req.body;

  switch (event.type) {
    case 'customer.subscription.created':
      await updateUserSubscription(event.data.object, 'active');
      break;

    case 'customer.subscription.deleted':
      await updateUserSubscription(event.data.object, 'canceled');
      break;

    case 'invoice.payment_failed':
      await updateUserSubscription(event.data.object, 'past_due');
      await notifyUserPaymentFailed(event.data.object);
      break;
  }

  res.json({ received: true });
});
```

### Tests de Validaci√≥n

```javascript
describe('Payment Validation', () => {
  it('should block male users without membership', async () => {
    const user = {
      gender: 'masculino',
      hasActiveSubscription: false
    };

    const result = checkPaymentStatus(user);

    expect(result.canUse).toBe(false);
    expect(result.reason).toBe('membership');
  });

  it('should block male users without insurance', async () => {
    const user = {
      gender: 'masculino',
      hasActiveSubscription: true,
      hasAntiGhostingInsurance: false
    };

    const result = checkPaymentStatus(user);

    expect(result.canUse).toBe(false);
    expect(result.reason).toBe('insurance');
  });

  it('should allow female users without payment', async () => {
    const user = {
      gender: 'femenino',
      hasActiveSubscription: false,
      hasAntiGhostingInsurance: false
    };

    const result = checkPaymentStatus(user);

    expect(result.canUse).toBe(true);
  });
});
```

---

## üìã Checklist de Implementaci√≥n

### Fase 1: Validaci√≥n en Frontend ‚úÖ
- [x] Crear funci√≥n `checkPaymentStatus()`
- [x] Modal de pago requerido
- [x] Banner de estado de pago
- [x] Validar en env√≠o de solicitudes
- [x] Validar en agendamiento de citas
- [x] Botones de redirecci√≥n a pago

### Fase 2: Backend (Pendiente)
- [ ] Cloud Functions para validar pagos
- [ ] Webhooks de Stripe
- [ ] Actualizaci√≥n autom√°tica de estados
- [ ] Emails de notificaci√≥n
- [ ] Sistema de reembolsos

### Fase 3: Pagos (Pendiente)
- [ ] Integraci√≥n con Stripe
- [ ] P√°gina de suscripci√≥n (/webapp/suscripcion.html)
- [ ] P√°gina de seguro (/webapp/seguro.html)
- [ ] Procesamiento de pagos
- [ ] Confirmaciones

### Fase 4: Testing (Pendiente)
- [ ] Tests unitarios de validaci√≥n
- [ ] Tests de integraci√≥n con Stripe
- [ ] Tests E2E del flujo completo
- [ ] Tests de edge cases

### Fase 5: Producci√≥n (Pendiente)
- [ ] Documentaci√≥n de API
- [ ] Monitoreo de errores
- [ ] Analytics de conversi√≥n
- [ ] A/B testing de precios
- [ ] Soporte para usuarios

---

## üéØ Conclusi√≥n

El sistema de **membres√≠a + seguro anti-plant√≥n** es el n√∫cleo del modelo de negocio de TuCitaSegura. Esta implementaci√≥n garantiza:

‚úÖ **Seriedad**: Solo usuarios comprometidos
‚úÖ **Seguridad**: Verificaci√≥n y garant√≠as
‚úÖ **Revenue**: Monetizaci√≥n sostenible
‚úÖ **Calidad**: Mejor experiencia para todos
‚úÖ **Escalabilidad**: Preparado para crecer

**Estado Actual:**
- Hombres: Membres√≠a (‚Ç¨29.99/mes) + Seguro (‚Ç¨120) ‚úÖ
- Mujeres: Acceso gratis (temporalmente) ‚úÖ
- Validaciones: Frontend completo ‚úÖ
- Backend: Pendiente implementaci√≥n ‚è≥

**Pr√≥ximo Paso:** Integrar Stripe y completar flujo de pagos.
